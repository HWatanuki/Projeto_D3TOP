{% extends 'bootstrap/base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
	<style>
		body { 
      background: #e8f1f9; 
      min-height: 100%;
    }
    .bg-image {
      background-color: #cac6c6;
      background-repeat: no-repeat;
      background-image: url('static/imgs/ifsp_logo.png');
      background-size: 20rem;
      background-position: left;
  }
  .required > label:after {
    content:" *"; 
    color: red;
  }
	</style>
{% endblock %}

{% block title %}
Buscador de anúncios Airbnb
{% endblock %}

{% block content %}

<header class="navbar navbar-expand bg-image flex-column flex-md-row bd-navbar" style="align-items: end;">
    <ul class="navbar-nav flex-row ml-md-auto d-md-flex my-3">
        <li>Especialização em Ciência de Dados
        <br>Projeto em grupo da disciplina D3TOP - Tópicos em Ciência de Dados
        </li>
        <li>Membros do grupo:</li>
            <ul>
                <li>Gabrielly Baratela (CP3016331)</li>
                <li>Halisson Souza Gomides (CP3016382)</li>
                <li>Hugo Martinelli Watanuki (CP3016692)</li>
            </ul>
    </ul>
  </header>
  <div class="container-fluid h-100">  

    <div class="row align-items-center">
   
      <div class="col-md-10 vw-100 mx-auto px-3">
  
        <h2 class="pt-1">Buscador de anúncios - Airbnb</h2>
        
        {% if form.errors %}
          {% for field, errors in form.errors.items() %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              {{ ','.join(errors) }}
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endfor %}
        {% else %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          Dados oriundos de amostras de anúncios da cidade de Nova York.
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endif %}
        <p class="pt-2"><strong>{{ message }}</strong></p>
  
        {{ wtf.quick_form(form) }}
        
        
      </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
     $('.form').submit(function(e){
    e.preventDefault(); // impede a execução do submit
    var form = $(this);
    var actionUrl = form.attr('action');
    // var btn = form.find("input[type=submit]").prop('outerHTML');
    var btn = form.find("#submit").prop('outerHTML');
    
    $.ajax({
      type: "POST",
      url: actionUrl,
      data: form.serialize(),
      xhrFields: {
                responseType: 'blob'
      },
      beforeSend: function(){
        form.find("#submit").replaceWith('\
        <div id="loading" class="row">\
          <div class="spinner-border text-primary" role="status">\
            <span class="sr-only">Loading...</span>\
          </div>\
          <div class="col py-1">Buscando...</div>\
        </div>');
        
      }
    }).done(function(data, statusText, xhr){
            
      $("#loading").replaceWith(btn);     
      
    });
  });
</script>
{% endblock %}
